import * as CookieFunctions from './cookie-functions.js';
/*todo: we don't meed a pollyfill for bind, as long as we server up the non js version of the site for ie8 (https://caniuse.com/?search=bind) */
/*import 'govuk-frontend/govuk/vendor/polyfills/Function/prototype/bind'*/
/*todo: i think we're ok for this too (see above about ie8), but we _might_ need it for >8 ie (use? https://www.npmjs.com/package/events-polyfill)*/
/*import 'govuk-frontend/govuk/vendor/polyfills/Event'*/
import { nodeListForEach } from './helpers';
import { sendPageViewEvent, sendFilterPageCustomEvent, sendAnalyticsCustomEvent, updateAnalyticsStorageConsent } from './analytics';
import { updateConsent as updateClarityConsent } from './clarity';
const cookieBannerAcceptSelector = '.js-cookie-banner-accept';
const cookieBannerRejectSelector = '.js-cookie-banner-reject';
const cookieBannerHideButtonSelector = '.js-cookie-banner-hide';
const cookieMessageSelector = '.js-cookie-banner-message';
const cookieConfirmationAcceptSelector = '.js-cookie-banner-confirmation-accept';
const cookieConfirmationRejectSelector = '.js-cookie-banner-confirmation-reject';
export default function CookieBanner($module) {
    this.$module = $module;
}
CookieBanner.prototype.init = function () {
    this.$cookieBanner = this.$module;
    this.$acceptButton = this.$module.querySelector(cookieBannerAcceptSelector);
    this.$rejectButton = this.$module.querySelector(cookieBannerRejectSelector);
    this.$cookieMessage = this.$module.querySelector(cookieMessageSelector);
    this.$cookieConfirmationAccept = this.$module.querySelector(cookieConfirmationAcceptSelector);
    this.$cookieConfirmationReject = this.$module.querySelector(cookieConfirmationRejectSelector);
    this.$cookieBannerHideButtons = this.$module.querySelectorAll(cookieBannerHideButtonSelector);
    // Exit if no cookie banner module
    // or if we're on the cookies page to avoid circular journeys
    if (!this.$cookieBanner || this.onCookiesPage()) {
        return;
    }
    // Show the cookie banner to users who have not consented or have an
    // outdated consent cookie
    var currentConsentCookie = CookieFunctions.getConsentCookie();
    if (!currentConsentCookie || !CookieFunctions.isValidConsentCookie(currentConsentCookie)) {
        // If the consent cookie version is not valid, we need to remove any cookies which have been
        // set previously
        CookieFunctions.resetCookies();
        this.$cookieBanner.removeAttribute('hidden');
    }
    this.$acceptButton.addEventListener('click', this.acceptCookies.bind(this));
    this.$rejectButton.addEventListener('click', this.rejectCookies.bind(this));
    nodeListForEach(this.$cookieBannerHideButtons, function ($cookieBannerHideButton) {
        $cookieBannerHideButton.addEventListener('click', this.hideBanner.bind(this));
    }.bind(this));
};
CookieBanner.prototype.hideBanner = function () {
    this.$cookieBanner.setAttribute('hidden', true);
};
CookieBanner.prototype.acceptCookies = function () {
    // Do actual cookie consent bit
    CookieFunctions.setConsentCookie({ analytics: true });
    updateAnalyticsStorageConsent(true);
    updateClarityConsent(true);
    sendAnalyticsCustomEvent(true, 'banner');
    sendPageViewEvent();
    sendFilterPageCustomEvent();
    // Hide banner and show confirmation message
    this.$cookieMessage.setAttribute('hidden', true);
    this.revealConfirmationMessage(this.$cookieConfirmationAccept);
};
CookieBanner.prototype.rejectCookies = function () {
    updateAnalyticsStorageConsent(true);
    sendAnalyticsCustomEvent(false, 'banner');
    updateAnalyticsStorageConsent(false);
    updateClarityConsent(false);
    //setTimeout(CookieFunctions.setConsentCookie.bind({ analytics: false }), 250);
    CookieFunctions.setConsentCookie({ analytics: false });
    // Hide banner and show confirmation message
    this.$cookieMessage.setAttribute('hidden', true);
    this.revealConfirmationMessage(this.$cookieConfirmationReject);
};
CookieBanner.prototype.revealConfirmationMessage = function (confirmationMessage) {
    confirmationMessage.removeAttribute('hidden');
    // Set tabindex to -1 to make the confirmation banner focusable with JavaScript
    if (!confirmationMessage.getAttribute('tabindex')) {
        confirmationMessage.setAttribute('tabindex', '-1');
        confirmationMessage.addEventListener('blur', function () {
            confirmationMessage.removeAttribute('tabindex');
        });
    }
    confirmationMessage.focus();
};
CookieBanner.prototype.onCookiesPage = function () {
    return window.location.pathname === '/cookies/';
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvY29va2llLWJhbm5lci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssZUFBZSxNQUFNLHVCQUF1QixDQUFBO0FBQ3hELGdKQUFnSjtBQUNoSiwwRUFBMEU7QUFDMUUsb0pBQW9KO0FBQ3BKLHdEQUF3RDtBQUN4RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sV0FBVyxDQUFBO0FBQzNDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSx5QkFBeUIsRUFBRSx3QkFBd0IsRUFBRSw2QkFBNkIsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUNwSSxPQUFPLEVBQUUsYUFBYSxJQUFJLG9CQUFvQixFQUFFLE1BQU0sV0FBVyxDQUFBO0FBRWpFLE1BQU0sMEJBQTBCLEdBQUcsMEJBQTBCLENBQUE7QUFDN0QsTUFBTSwwQkFBMEIsR0FBRywwQkFBMEIsQ0FBQTtBQUM3RCxNQUFNLDhCQUE4QixHQUFHLHdCQUF3QixDQUFBO0FBQy9ELE1BQU0scUJBQXFCLEdBQUcsMkJBQTJCLENBQUE7QUFDekQsTUFBTSxnQ0FBZ0MsR0FBRyx1Q0FBdUMsQ0FBQTtBQUNoRixNQUFNLGdDQUFnQyxHQUFHLHVDQUF1QyxDQUFBO0FBRWhGLE1BQU0sQ0FBQyxPQUFPLFVBQVUsWUFBWSxDQUFDLE9BQW9CO0lBQ3JELElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0FBQzNCLENBQUM7QUFFRCxZQUFZLENBQUMsU0FBUyxDQUFDLElBQUksR0FBRztJQUMxQixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUE7SUFDakMsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQywwQkFBMEIsQ0FBQyxDQUFBO0lBQzNFLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsMEJBQTBCLENBQUMsQ0FBQTtJQUMzRSxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FB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QUUsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUV2RCw0Q0FBNEM7SUFDNUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFBO0lBQ2hELElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsQ0FBQTtBQUNsRSxDQUFDLENBQUE7QUFFRCxZQUFZLENBQUMsU0FBUyxDQUFDLHlCQUF5QixHQUFHLFVBQVUsbUJBQW1CO0lBQzVFLG1CQUFtQixDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUU3QywrRUFBK0U7SUFDL0UsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDO1FBQ2hELG1CQUFtQixDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFFbEQsbUJBQW1CLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFO1lBQ3pDLG1CQUFtQixDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQTtRQUNuRCxDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFFRCxtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtBQUMvQixDQUFDLENBQUE7QUFFRCxZQUFZLENBQUMsU0FBUyxDQUFDLGFBQWEsR0FBRztJQUNuQyxPQUFPLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxLQUFLLFdBQVcsQ0FBQTtBQUNuRCxDQUFDLENBQUEiLCJmaWxlIjoiY29tcG9uZW50cy9jb29raWUtYmFubmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgQ29va2llRnVuY3Rpb25zIGZyb20gJy4vY29va2llLWZ1bmN0aW9ucy5qcydcbi8qdG9kbzogd2UgZG9uJ3QgbWVlZCBhIHBvbGx5ZmlsbCBmb3IgYmluZCwgYXMgbG9uZyBhcyB3ZSBzZXJ2ZXIgdXAgdGhlIG5vbiBqcyB2ZXJzaW9uIG9mIHRoZSBzaXRlIGZvciBpZTggKGh0dHBzOi8vY2FuaXVzZS5jb20vP3NlYXJjaD1iaW5kKSAqL1xuLyppbXBvcnQgJ2dvdnVrLWZyb250ZW5kL2dvdnVrL3ZlbmRvci9wb2x5ZmlsbHMvRnVuY3Rpb24vcHJvdG90eXBlL2JpbmQnKi9cbi8qdG9kbzogaSB0aGluayB3ZSdyZSBvayBmb3IgdGhpcyB0b28gKHNlZSBhYm92ZSBhYm91dCBpZTgpLCBidXQgd2UgX21pZ2h0XyBuZWVkIGl0IGZvciA+OCBpZSAodXNlPyBodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9ldmVudHMtcG9seWZpbGwpKi9cbi8qaW1wb3J0ICdnb3Z1ay1mcm9udGVuZC9nb3Z1ay92ZW5kb3IvcG9seWZpbGxzL0V2ZW50JyovXG5pbXBvcnQgeyBub2RlTGlzdEZvckVhY2ggfSBmcm9tICcuL2hlbHBlcnMnXG5pbXBvcnQgeyBzZW5kUGFnZVZpZXdFdmVudCwgc2VuZEZpbHRlclBhZ2VDdXN0b21FdmVudCwgc2VuZEFuYWx5dGljc0N1c3RvbUV2ZW50LCB1cGRhdGVBbmFseXRpY3NTdG9yYWdlQ29uc2VudCB9IGZyb20gJy4vYW5hbHl0aWNzJztcbmltcG9ydCB7IHVwZGF0ZUNvbnNlbnQgYXMgdXBkYXRlQ2xhcml0eUNvbnNlbnQgfSBmcm9tICcuL2NsYXJpdHknXG5cbmNvbnN0IGNvb2tpZUJhbm5lckFjY2VwdFNlbGVjdG9yID0gJy5qcy1jb29raWUtYmFubmVyLWFjY2VwdCdcbmNvbnN0IGNvb2tpZUJhbm5lclJlamVjdFNlbGVjdG9yID0gJy5qcy1jb29raWUtYmFubmVyLXJlamVjdCdcbmNvbnN0IGNvb2tpZUJhbm5lckhpZGVCdXR0b25TZWxlY3RvciA9ICcuanMtY29va2llLWJhbm5lci1oaWRlJ1xuY29uc3QgY29va2llTWVzc2FnZVNlbGVjdG9yID0gJy5qcy1jb29raWUtYmFubmVyLW1lc3NhZ2UnXG5jb25zdCBjb29raWVDb25maXJtYXRpb25BY2NlcHRTZWxlY3RvciA9ICcuanMtY29va2llLWJhbm5lci1jb25maXJtYXRpb24tYWNjZXB0J1xuY29uc3QgY29va2llQ29uZmlybWF0aW9uUmVqZWN0U2VsZWN0b3IgPSAnLmpzLWNvb2tpZS1iYW5uZXItY29uZmlybWF0aW9uLXJlamVjdCdcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQ29va2llQmFubmVyKCRtb2R1bGU6IEhUTUxFbGVtZW50KSB7XG4gICAgdGhpcy4kbW9kdWxlID0gJG1vZHVsZTtcbn1cblxuQ29va2llQmFubmVyLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuJGNvb2tpZUJhbm5lciA9IHRoaXMuJG1vZHVsZVxuICAgIHRoaXMuJGFjY2VwdEJ1dHRvbiA9IHRoaXMuJG1vZHVsZS5xdWVyeVNlbGVjdG9yKGNvb2tpZUJhbm5lckFjY2VwdFNlbGVjdG9yKVxuICAgIHRoaXMuJHJlamVjdEJ1dHRvbiA9IHRoaXMuJG1vZHVsZS5xdWVyeVNlbGVjdG9yKGNvb2tpZUJhbm5lclJlamVjdFNlbGVjdG9yKVxuICAgIHRoaXMuJGNvb2tpZU1lc3NhZ2UgPSB0aGlzLiRtb2R1bGUucXVlcnlTZWxlY3Rvcihjb29raWVNZXNzYWdlU2VsZWN0b3IpXG4gICAgdGhpcy4kY29va2llQ29uZmlybWF0aW9uQWNjZXB0ID0gdGhpcy4kbW9kdWxlLnF1ZXJ5U2VsZWN0b3IoY29va2llQ29uZmlybWF0aW9uQWNjZXB0U2VsZWN0b3IpXG4gICAgdGhpcy4kY29va2llQ29uZmlybWF0aW9uUmVqZWN0ID0gdGhpcy4kbW9kdWxlLnF1ZXJ5U2VsZWN0b3IoY29va2llQ29uZmlybWF0aW9uUmVqZWN0U2VsZWN0b3IpXG4gICAgdGhpcy4kY29va2llQmFubmVySGlkZUJ1dHRvbnMgPSB0aGlzLiRtb2R1bGUucXVlcnlTZWxlY3RvckFsbChjb29raWVCYW5uZXJIaWRlQnV0dG9uU2VsZWN0b3IpXG5cbiAgICAvLyBFeGl0IGlmIG5vIGNvb2tpZSBiYW5uZXIgbW9kdWxlXG4gICAgLy8gb3IgaWYgd2UncmUgb24gdGhlIGNvb2tpZXMgcGFnZSB0byBhdm9pZCBjaXJjdWxhciBqb3VybmV5c1xuICAgIGlmICghdGhpcy4kY29va2llQmFubmVyIHx8IHRoaXMub25Db29raWVzUGFnZSgpKSB7XG4gICAgICAgIHJldHVyblxuICAgIH1cblxuICAgIC8vIFNob3cgdGhlIGNvb2tpZSBiYW5uZXIgdG8gdXNlcnMgd2hvIGhhdmUgbm90IGNvbnNlbnRlZCBvciBoYXZlIGFuXG4gICAgLy8gb3V0ZGF0ZWQgY29uc2VudCBjb29raWVcbiAgICB2YXIgY3VycmVudENvbnNlbnRDb29raWUgPSBDb29raWVGdW5jdGlvbnMuZ2V0Q29uc2VudENvb2tpZSgpXG5cbiAgICBpZiAoIWN1cnJlbnRDb25zZW50Q29va2llIHx8ICFDb29raWVGdW5jdGlvbnMuaXNWYWxpZENvbnNlbnRDb29raWUoY3VycmVudENvbnNlbnRDb29raWUpKSB7XG4gICAgICAgIC8vIElmIHRoZSBjb25zZW50IGNvb2tpZSB2ZXJzaW9uIGlzIG5vdCB2YWxpZCwgd2UgbmVlZCB0byByZW1vdmUgYW55IGNvb2tpZXMgd2hpY2ggaGF2ZSBiZWVuXG4gICAgICAgIC8vIHNldCBwcmV2aW91c2x5XG4gICAgICAgIENvb2tpZUZ1bmN0aW9ucy5yZXNldENvb2tpZXMoKVxuXG4gICAgICAgIHRoaXMuJGNvb2tpZUJhbm5lci5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpXG4gICAgfVxuXG4gICAgdGhpcy4kYWNjZXB0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5hY2NlcHRDb29raWVzLmJpbmQodGhpcykpXG4gICAgdGhpcy4kcmVqZWN0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5yZWplY3RDb29raWVzLmJpbmQodGhpcykpXG5cbiAgICBub2RlTGlzdEZvckVhY2godGhpcy4kY29va2llQmFubmVySGlkZUJ1dHRvbnMsIGZ1bmN0aW9uICgkY29va2llQmFubmVySGlkZUJ1dHRvbikge1xuICAgICAgICAkY29va2llQmFubmVySGlkZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGlkZUJhbm5lci5iaW5kKHRoaXMpKVxuICAgIH0uYmluZCh0aGlzKSlcbn1cblxuQ29va2llQmFubmVyLnByb3RvdHlwZS5oaWRlQmFubmVyID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuJGNvb2tpZUJhbm5lci5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsIHRydWUpXG59XG5cbkNvb2tpZUJhbm5lci5wcm90b3R5cGUuYWNjZXB0Q29va2llcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAvLyBEbyBhY3R1YWwgY29va2llIGNvbnNlbnQgYml0XG4gICAgQ29va2llRnVuY3Rpb25zLnNldENvbnNlbnRDb29raWUoeyBhbmFseXRpY3M6IHRydWUgfSk7XG5cbiAgICB1cGRhdGVBbmFseXRpY3NTdG9yYWdlQ29uc2VudCh0cnVlKTtcbiAgICB1cGRhdGVDbGFyaXR5Q29uc2VudCh0cnVlKTtcblxuICAgIHNlbmRBbmFseXRpY3NDdXN0b21FdmVudCh0cnVlLCAnYmFubmVyJyk7XG4gICAgc2VuZFBhZ2VWaWV3RXZlbnQoKTtcbiAgICBzZW5kRmlsdGVyUGFnZUN1c3RvbUV2ZW50KCk7XG5cbiAgICAvLyBIaWRlIGJhbm5lciBhbmQgc2hvdyBjb25maXJtYXRpb24gbWVzc2FnZVxuICAgIHRoaXMuJGNvb2tpZU1lc3NhZ2Uuc2V0QXR0cmlidXRlKCdoaWRkZW4nLCB0cnVlKVxuICAgIHRoaXMucmV2ZWFsQ29uZmlybWF0aW9uTWVzc2FnZSh0aGlzLiRjb29raWVDb25maXJtYXRpb25BY2NlcHQpXG59XG5cbkNvb2tpZUJhbm5lci5wcm90b3R5cGUucmVqZWN0Q29va2llcyA9IGZ1bmN0aW9uICgpIHtcblxuICAgIHVwZGF0ZUFuYWx5dGljc1N0b3JhZ2VDb25zZW50KHRydWUpO1xuXG4gICAgc2VuZEFuYWx5dGljc0N1c3RvbUV2ZW50KGZhbHNlLCAnYmFubmVyJyk7XG5cbiAgICB1cGRhdGVBbmFseXRpY3NTdG9yYWdlQ29uc2VudChmYWxzZSk7XG4gICAgdXBkYXRlQ2xhcml0eUNvbnNlbnQoZmFsc2UpO1xuXG4gICAgLy9zZXRUaW1lb3V0KENvb2tpZUZ1bmN0aW9ucy5zZXRDb25zZW50Q29va2llLmJpbmQoeyBhbmFseXRpY3M6IGZhbHNlIH0pLCAyNTApO1xuICAgIENvb2tpZUZ1bmN0aW9ucy5zZXRDb25zZW50Q29va2llKHsgYW5hbHl0aWNzOiBmYWxzZSB9KTtcblxuICAgIC8vIEhpZGUgYmFubmVyIGFuZCBzaG93IGNvbmZpcm1hdGlvbiBtZXNzYWdlXG4gICAgdGhpcy4kY29va2llTWVzc2FnZS5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsIHRydWUpXG4gICAgdGhpcy5yZXZlYWxDb25maXJtYXRpb25NZXNzYWdlKHRoaXMuJGNvb2tpZUNvbmZpcm1hdGlvblJlamVjdClcbn1cblxuQ29va2llQmFubmVyLnByb3RvdHlwZS5yZXZlYWxDb25maXJtYXRpb25NZXNzYWdlID0gZnVuY3Rpb24gKGNvbmZpcm1hdGlvbk1lc3NhZ2UpIHtcbiAgICBjb25maXJtYXRpb25NZXNzYWdlLnJlbW92ZUF0dHJpYnV0ZSgnaGlkZGVuJylcblxuICAgIC8vIFNldCB0YWJpbmRleCB0byAtMSB0byBtYWtlIHRoZSBjb25maXJtYXRpb24gYmFubmVyIGZvY3VzYWJsZSB3aXRoIEphdmFTY3JpcHRcbiAgICBpZiAoIWNvbmZpcm1hdGlvbk1lc3NhZ2UuZ2V0QXR0cmlidXRlKCd0YWJpbmRleCcpKSB7XG4gICAgICAgIGNvbmZpcm1hdGlvbk1lc3NhZ2Uuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICctMScpXG5cbiAgICAgICAgY29uZmlybWF0aW9uTWVzc2FnZS5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uZmlybWF0aW9uTWVzc2FnZS5yZW1vdmVBdHRyaWJ1dGUoJ3RhYmluZGV4JylcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBjb25maXJtYXRpb25NZXNzYWdlLmZvY3VzKClcbn1cblxuQ29va2llQmFubmVyLnByb3RvdHlwZS5vbkNvb2tpZXNQYWdlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09ICcvY29va2llcy8nXG59XG4iXX0=
