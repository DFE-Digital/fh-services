@using FamilyHubs.ServiceDirectory.Shared.ReferenceData
@using FamilyHubs.ServiceDirectory.Shared.ReferenceData.ICalendar
@model FamilyHubs.Referral.Web.Pages.ProfessionalReferral.LocalOfferResultsModel

<button data-toggle-visibility-id="filters" id="open-close-filters"
        class="govuk-button govuk-button--secondary app-open-close-filters" data-module="govuk-button"
        type="button">Open / close filters
</button>

<div class="govuk-grid-column-one-third">
    <div class="moj-filter">
        <div class="moj-filter__selected">
            <div class="govuk-!-padding-bottom-4">
                <div class="moj-filter__selected-heading">
                    <div class="moj-filter__heading-title">
                        <h2 class="govuk-heading-m">Filter results</h2>
                    </div>
                    <div class="moj-filter__heading-action">
                        <a asp-page="/ProfessionalReferral/LocalOfferResults" asp-route-postcode="@Model.Postcode" asp-route-correlationid="@Model.CorrelationId" class="govuk-link govuk-link--no-visited-state" data-testid="clear-all-filters">Clear filters</a>
                    </div>
                </div>
            </div>
            
            @* - Remove Categories - *@
            @if (Model.SubcategorySelection?.Any() == true)
            {
                <h3 class="govuk-heading-s govuk-!-margin-bottom-1">Category</h3>
                <ul class="moj-filter-tags">
                    @foreach (var selectedCategory in Model.SubcategorySelection.Select(int.Parse))
                    {
                        string dataTestId = $"clear-filter-category-{selectedCategory}";
                        <li>
                            <button data-testid=@dataTestId type="submit" class="moj-filter__tag fh-icon-cross" asp-route-removeFilter=true name="removeCategories" value=@selectedCategory>
                                <span class="govuk-visually-hidden">Remove this filter</span>
                                @Model.Categories.First(category => category.Id == selectedCategory).Name
                            </button>
                        </li>
                    }
                </ul>
            }
            @* - Remove Categories - *@

            @* - Remove Cost - *@
            @if (Model.OnlyShowFreeServices)
            {
                <h3 class="govuk-heading-s govuk-!-margin-bottom-1">Cost</h3>
                <ul class="moj-filter-tags">
                    <li>
                        <span class="govuk-visually-hidden">Remove this filter</span>
                        <button data-testid="clear-filter-cost" type="submit" class="moj-filter__tag fh-icon-cross" asp-route-removeFilter=true name="removeCost" value="true">
                            Only show free services
                        </button>
                    </li>
                </ul>
            }
            @* - Remove Cost - *@

            @* - Remove Days Available - *@
            @if (Model.DaysAvailable?.Any() == true)
            {
                <h3 class="govuk-heading-s govuk-!-margin-bottom-1">Days service is available</h3>
                <ul class="moj-filter-tags">
                    @foreach (var daySelected in Model.DaysAvailable)
                    {
                        string dataTestId = $"clear-filter-days_available-{daySelected}";
                        <li>
                            <span class="govuk-visually-hidden">Remove this filter</span>
                            <button data-testid=@dataTestId type="submit" class="moj-filter__tag fh-icon-cross" asp-route-removeFilter=true name="removeDaysAvailable" value=@daySelected>
                                @Calendar.DayCodeToName[daySelected]
                            </button>
                        </li>
                    }
                </ul>
            }
            @* - Remove Days Available - *@

            @* - Remove Age - *@
            @if (Model.SelectedAges?.Any() == true)
            {
                <h3 class="govuk-heading-s govuk-!-margin-bottom-1">Age</h3>
                <ul class="moj-filter-tags">
                    @foreach (var selectedAge in Model.SelectedAges)
                    {
                        string dataTestId = $"clear-filter-age-{selectedAge}";
                        <li>
                            <span class="govuk-visually-hidden">Remove this filter</span>
                            <button data-testid=@dataTestId type="submit" class="moj-filter__tag fh-icon-cross" asp-route-removeFilter=true name="removeAge" value=@selectedAge>
                                @LocalOfferResultsModel.AgeRange.First(age => age.Value.Equals(selectedAge)).Text
                            </button>
                        </li>
                    }
                </ul>
            }
            @* - Remove Age - *@

            @* - Remove Language - *@
            @if (Model.SelectedLanguage is not null)
            {
                <h3 class="govuk-heading-s govuk-!-margin-bottom-1">Language</h3>
                <ul class="moj-filter-tags">
                    <li>
                        <span class="govuk-visually-hidden">Remove this filter</span>
                        <button data-testid="clear-filter-language" type="submit" class="moj-filter__tag fh-icon-cross" asp-route-removeFilter=true name="removeLanguage" value=@Model.SelectedLanguage>
                            @Languages.CodeToName[Model.SelectedLanguage]
                        </button>
                    </li>
                </ul>
            }
            @* - Remove Language - *@

            @* - Remove Search Within - *@
            @if (Model.SelectedDistance is not null)
            {
                <h3 class="govuk-heading-s govuk-!-margin-bottom-1">Search within</h3>
                <ul class="moj-filter-tags">
                    <li>
                        <span class="govuk-visually-hidden">Remove this filter</span>
                        <button data-test-id="clear-filter-search_within" type="submit" class="moj-filter__tag fh-icon-cross" asp-route-removeFilter=true name="removeSearchWithin" value=@Model.SelectedDistance>
                            @LocalOfferResultsModel.DistanceRange.First(distance => distance.Value.Equals(Model.SelectedDistance)).Text
                        </button>
                    </li>
                </ul>
            }
            @* - Remove Search Within - *@
            
        </div>
        <div class="moj-filter__content">
            <div class="moj-filter__options">
                <div class="govuk-form-group">
                    @await Html.PartialAsync("LocalOfferResultsPartialViews/Filters/_Categories", Model)
                    @await Html.PartialAsync("LocalOfferResultsPartialViews/Filters/_Cost", Model)
                    @await Html.PartialAsync("LocalOfferResultsPartialViews/Filters/_DaysAvailable", Model)
                    @await Html.PartialAsync("LocalOfferResultsPartialViews/Filters/_Age", Model)
                    @await Html.PartialAsync("LocalOfferResultsPartialViews/Filters/_Languages", Model)
                    @await Html.PartialAsync("LocalOfferResultsPartialViews/Filters/_SearchWithin", Model)
                </div>
                <button type="submit" class="govuk-button" data-module="govuk-button"
                        data-test-id="submit-button">
                    Apply filters
                </button>

            </div>
        </div>
    </div>
</div>